<!DOCTYPE html>
<html>

<head>
    <title>Wiskunde App</title>
    <script src="code.js"></script>
    <script src="opgaven.js"></script>



    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/5.0.1/math.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-beta/katex.min.css" integrity="sha384-L/SNYu0HM7XECWBeshTGLluQO9uVI1tvkCtunuoUbCHHoTH76cDyXty69Bb9I0qZ"
        crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-beta/katex.min.js" integrity="sha384-ad+n9lzhJjYgO67lARKETJH6WuQVDDlRfj81AJJSswMyMkXTD49wBj5EP004WOY6"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
        crossorigin="anonymous">



    <link rel="stylesheet" type="text/css" href="style.css">


    <body>



        <div class='container-fluid'>

            <!-- <div class='row'>

                <button type="button" class="btn btn-primary" id="button_f1" onclick="f1_release(equation)">  Z </button>
                <button type="button" class="btn btn-primary" id="button_f2" onclick="f2_release(equation);">  plus </button>
                <button type="button" class="btn btn-primary" id="button_f3" onclick="f3_release(equation);">  times </button>
                <button type="button" class="btn btn-primary" id="button_f4" onclick="f4_release(equation);">  min </button>
                <button type="button" class="btn btn-primary" id="button_f5" onclick="f5_release(equation);">  fraction </button>
                <button type="button" class="btn btn-primary" id="button_f6" onclick="f6_release(equation);">  power </button>
                <button type="button" class="btn btn-primary" id="button_f7" onclick="f7_release(equation);">  exp </button>
                <button type="button" class="btn btn-primary" id="button_f8" onclick="f8_release(equation);">  root </button>
                <button type="button" class="btn btn-primary" id="button_f9" onclick="f9_release(equation);">  log </button>
                <button type="button" class="btn btn-primary" id="button_f10" onclick="f10_release(equation);">  equals </button>
                <button type="button" class="btn btn-primary" id="button_f11" onclick="f11_release(equation);">  > </button>
                <button type="button" class="btn btn-primary" id="button_f12" onclick="f12_release(equation);">  < </button>


            </div> -->

            <div class='row'>

                <div class='col-md-4'>
                        <div class="card">
                        <div class='card-header'> F1: naar getal</div>
                        <div class="card-body">
                            <p class="card-text" id="f1_button">$$$$</p>

                        </div>
                        </div>
                </div>

                <div class='col-md-4'>

                </div>

                <div class='col-md-4'>
                        <div class="card">
                        <div class='card-header'> F2: naar plus </div>
                        <div class="card-body">
                            <p class="card-text" id="f2_button">$$$$</p>
                        </div>
                        </div>

                </div>

                <div class='col-md-3'>
                        <div class="card">
                        <div class='card-header'> F3: naar maal</div>
                        <div class="card-body">
                            <p class="card-text" id="f3_button">$$$$</p>
                        </div>
                        </div>

                        <div class="card">
                        <div class='card-header'> F5: naar breuk </div>
                        <div class="card-body">
                            <p class="card-text" id="f5_button">$$$$</p>
                        </div>
                        </div>

                        <div class="card">
                        <div class='card-header'> F7: naar exp </div>
                        <div class="card-body">
                            <p class="card-text" id="f7_button">$$$$</p>
                        </div>
                        </div>

                        <div class="card">
                        <div class='card-header'> F9: naar log </div>
                        <div class="card-body">
                            <p class="card-text" id="f9_button">$$$$</p>
                        </div>
                        </div>

                </div>

                <!-- <div class='col-md' id="middle"> -->
                <div class='col-md-6'>

                    <div class="card" id="hoofdvergelijking">
                        <div class='card-header'> Vgl 1</div>
                        <div class="card-body">
                            <p class="card-text" id="pretty">$$$$</p>
                            <p class="card-text" id="result"> </p>
                            <p class="card-text" id="expr"> </p>
                        </div>
                    </div>

                    <!-- <div class="card">
                        <div class="card-body">
                            <p class="card-text">Vgl 2</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-body">
                            <p class="card-text">Vgl 3</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-body">
                            <p class="card-text">Vgl 4</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-body">
                            <p class="card-text">Vgl 5</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-body">
                            <p class="card-text">Vgl 6</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-body">
                            <p class="card-text">Vgl 7</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-body">
                            <p class="card-text">Vgl 5</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-body">
                            <p class="card-text">Vgl 6</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-body">
                            <p class="card-text">Vgl 7</p>
                        </div>
                    </div> -->


                </div>

                <div class='col-md-3'>
                        <div class="card">
                                <div class='card-header'> F4: naar min</div>
                                <div class="card-body">
                                    <p class="card-text" id="f4_button">$$$$</p>
                                </div>
                        </div>

                        <div class="card">
                        <div class='card-header'> F6: naar macht</div>
                        <div class="card-body">
                            <p class="card-text" id="f6_button">$$$$</p>
                        </div>
                        </div>

                        <div class="card">
                        <div class='card-header'> F8: naar wortel</div>
                        <div class="card-body">
                            <p class="card-text" id="f8_button">$$$$</p>
                        </div>
                        </div>

                        <div class="card">
                        <div class='card-header'> F10</div>
                        <div class="card-body">
                            <p class="card-text" id="f10_button">$$$$</p>
                        </div>
                        </div>
                </div>


                
                
            </div>

            <div class='row'>

                    <div class='col-md-4'>
                            <div class="card">
                            <div class='card-header'> F11</div>
                            <div class="card-body">
                                <p class="card-text" id="f11_button">$$$$</p>
                            </div>
                            </div>
    
                    </div>

                    <div class='col-md-4'>

                                 <button type="button" class="btn btn-primary" id="up_pos" style="position:relative;left:50%;top:-20%" onclick="upSelect(equation)">  up </button>
                                 <button type="button" class="btn btn-primary" id="left_pos" style="position:relative;left:20%;top:30%" onclick="leftSelect(equation)">  left </button>
                                 <button type="button" class="btn btn-primary" id="current_pos" style="position:relative;left:20%;top:30%" onclick="">  Selectie </button>
                                 <button type="button" class="btn btn-primary" id="right_pos" style="position:relative;left:20%;top:30%" onclick="rightSelect(equation)">  right </button>
                                 <button type="button" class="btn btn-primary" id="down_pos" style="position:relative;left:-15%;top:80%" onclick="downSelect(equation)">  down </button>
                    </div>

                    <div class='col-md-4'>
                            <div class="card">
                            <div class='card-header'> F12</div>
                            <div class="card-body">
                                <p class="card-text" id="f12_button">$$$$</p>
                            </div>
                            </div>
    
                    </div>

            </div>



            <div class='row'>
                    <!-- <div class='col-md' id='bottom'>
            </div> -->

            <div class='col-md'>

                <div> Grafieken </div>

                <div class="card">
                    <div class="card-body">
                        <p class="card-text">Grafiek</p>

                        <canvas id="myCanvas" width="300" height="300">
                            Fallback content, in case the browser does not support Canvas.
                        </canvas>

                        <input type="range" value="7" min="0" max="10" name="range">

                        <input type="range" min="0" max="100" value="50" class="vertical" orient="vertical">

                    </div>
                </div>

                <div class='row'>

                        <div> Rekenregels</div>
    
                        <div class="card" onclick="applyRule(regelNode1,equation)">
                            <div class='card-header'> regel 1</div>
                            <div class="card-body">
                            <p class="card-text" id="regel1">$$$$</p>
    
                            </div>
                        </div>
    
                        <div class="card">
                            <div class='card-header'> regel 2</div>
                            <div class="card-body">
                            <p class="card-text" id="regel2">$$$$</p>
    
                            </div>
                        </div>
    
                        <div class="card">
                                <div class='card-header'> regel 3</div>
                                <div class="card-body">
                                <p class="card-text" id="regel3">$$$$</p>
        
                                </div>
                            </div>
    
                    </div>

                <div class="row">
                    <div class="col-md-6">
    
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title">Instellingen </h4>
                                <h6 class="card-subtitle mb-2 text-muted">Card subtitle</h6>
    
                                <select id='keyboardType' onchange="changeKeyboardType()">
                                    <option value="wouterCode">Wouter code</option>
                                    <option value="wouterCodeNumpad">Wouter met numpad</option>
                                    <option value="svenCode">Sven code</option>
                                    <option value="wouterkeyCode">Wouter keyCode</option>
                                    <option value="svenkeyCode">Sven Code</option>

                                </select>
    
                            </div>
                            <div class="card-body">
                                <b>Parenthesis option:</b>
                                <input type="radio" name="parenthesis" value="keep" onclick="parenthesis = 'keep'; expr.oninput();" checked>keep
                                <input type="radio" name="parenthesis" value="auto" onclick="parenthesis = 'auto'; expr.oninput();">auto
                                <input type="radio" name="parenthesis" value="all" onclick="parenthesis = 'all'; expr.oninput();">all
                                <br/>
                                <b>Implicit multiplication:</b>
                                <input type="radio" name="implicit" value="hide" onclick="implicit = 'hide'; expr.oninput();" checked>hide
                                <input type="radio" name="implicit" value="show" onclick="implicit = 'show'; expr.oninput();">show
                                <p class="output"> para 2</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
    
                        <div class="card">
                                <div class="card-body">
                                        <h4 class="card-title"> Modus </h4>
                                        <input type="radio" name="modus" value="bouwmodus" onclick="modus = 'bouw'; expr.oninput();" checked>bouwmodus
                                        <input type="radio" name="modus" value="manipulatiemodus" onclick="modus = 'manipulatie'; expr.oninput();" >manipulatiemodus
            
                                    </div>
                            <div class="card-body">
                                <h4 class="card-title">Toetsen </h4>
                                <p> pijltjes om door de vergelijking te bewegen</p>
                                <p> de zes toetsen naast enter zijn standaardbewerkingen</p>
                                <p> ALT en de letter d voor een update van de grafiek</p>
                                <p> ALT en = om een propere vergelijking te krijgen</p>
                                <p> Cijfers (zonder shift) voor cijfers</p>
                                <p> SHIFT en pijltjes om de selectie uit te breiden</p>
    
                            </div>
    
                        </div>
                    </div>
                </div>

            </div>


            </div>

            <script>  

                //CANVAS GEDOE


                var canvas = document.getElementById("myCanvas");
                var canvasWidth = canvas.width;
                var canvasHeight = canvas.height;
                var ctx = canvas.getContext("2d");
                var canvasData = ctx.getImageData(0, 0, canvasWidth, canvasHeight);

                // That's how you define the value of a pixel //
                function drawPixel(x, y, r, g, b, a) {
                    var index = (x + y * canvasWidth) * 4;

                    canvasData.data[index + 0] = r;
                    canvasData.data[index + 1] = g;
                    canvasData.data[index + 2] = b;
                    canvasData.data[index + 3] = a;
                }

                // That's how you update the canvas, so that your //
                // modification are taken in consideration //
                function updateCanvas() {
                    ctx.putImageData(canvasData, 0, 0);
                } 
            </script>





            <script>

                // velden in de html benoemen

                var out = document.querySelector(".output");

                var expr = document.getElementById('expr'),
                    pretty = document.getElementById('pretty'),
                    result = document.getElementById('result'),
                    transfo = document.getElementById('transfo'),
                    parenthesis = 'keep',
                    implicit = 'hide',
                    modus = 'bouw';

                var f1_button = document.getElementById('f1_button'),
                    f2_button = document.getElementById('f2_button'),
                    f3_button = document.getElementById('f3_button'),
                    f4_button = document.getElementById('f4_button'),
                    f5_button = document.getElementById('f5_button'),
                    f6_button = document.getElementById('f6_button'),
                    f7_button = document.getElementById('f7_button'),
                    f8_button = document.getElementById('f8_button'),
                    f9_button = document.getElementById('f9_button'),
                    f10_button = document.getElementById('f10_button'),
                    f11_button = document.getElementById('f11_button'),
                    f12_button = document.getElementById('f12_button');    

                    

                // rekenregels

                var regel1 = document.getElementById('regel1'),
                    regel2 = document.getElementById('regel2'),
                    regel3 = document.getElementById('regel3')

                // Selectfunctie en andere speciale functies importeren

                math.import(customFunctions);
                // math.nthRoot.toTex = '\\sqrt[${args[1]}]{${args[0]}}';
                math.pow.toTex = function (node, options) {

                    // console.log(multiFunction[node.args[0].name] == 1);
                    // console.log(node.args[0].name == 'nthRoot');
                    // console.log(node.args[0].name == 'unaryMinus');
                    // console.log(node.args[0].fn == 'divide');
                    // console.log(node.args[0].fn == 'pow');

                    if (multiFunction[node.args[0].name] == 1 || node.args[0].name == 'nthRoot' || node.args[0].name == 'unaryMinus' || node.args[0].fn == 'divide' || node.args[0].fn == 'pow') {
                    // console.log('moethaakjeskrijgen');
                        return "\\left(" + node.args[0].toTex(options) + "\\right)^{" + node.args[1].toTex(options) + "}";
                    } else {
                        return "{" + node.args[0].toTex(options) + "}" + "^{" + node.args[1].toTex(options) + "}";
                    }

                };

                math.unaryMinus.toTex = function (node, options) {

                    if (multiFunction[node.args[0].name] == 1) {
                        return "-\\left(" + node.args[0].toTex(options) + "\\right)";
                    } else {
                        return "-" + node.args[0].toTex(options);
                    }

                };

                // "-\\left(${args[0]}\\right)"

                // Initialisatie van de state variabelen: begin met een lege vergelijking en een lege keyslist








                ///*********************************************************************
                /// Initialisatie van objecten
                ///*********************************************************************

                tijd = new Date();
                laatsteDigitOfLetterTijdStip = tijd.getTime();

                toegekendeBewerking = {
                    "f1": "getal",
                    "f2": "plus",
                    "f3": "times",
                    "f4": "min",
                    "f5": "breuk",
                    "f6": "macht",
                    "f7": "exp",
                    "f8": "wortel",
                    "f9": "log"
                };

                toegekendeFunctie = {
                    "f1": naargetal,
                    "f2": naarplus,
                    "f3": naartimes,
                    "f4": naarmin,
                    "f5": naarbreuk,
                    "f6": naarmacht,
                    "f7": naarexp,
                    "f8": naarwortel,
                    "f9": naarlog
                };

                regels = {
                    aMinA: {
                        naam: 'a min a',
                        input: {
                            expr: math.parse('Plus(a,unaryMinus(a))'),
                            unknowns: ['a']
                        },
                        output: {
                            expr: math.parse('0'),
                            unknowns: []
                        },
                    },

                    nulNeutraalVoorPlus: {
                        naam: '0 neutraal element voor +',
                        input: {
                            expr: math.parse('Plus(a,unaryMinus(a))'),
                            unknowns: ['a']
                        },
                        output: {
                            expr: math.parse('0'),
                            unknowns: []
                        },
                        functie: function(expr) {
                            if (expr.name == 'Plus') {
                                if (expr.args.some(s => s.value == 0)) {
                                    console.log('good onez');
                                    newterms = [];
                                    expr.args.forEach(term => {if (term.value != 0) {newterms.push(term)}});
                                    newexp = makeMulti('Plus', newterms);
                                    console.log('newexp =' + newexp.toString());
                                    return newexp;
                                } 
                            } 
                        
                        }

                    },
                    eenNeutraalVoorMaal: {
                        naam: '1 neutraal element voor *',
                        input: {
                            expr: math.parse('a/1'),
                            unknowns: ['a']
                        },
                        output: {
                            expr: math.parse('a'),
                            unknowns: ['a']
                        },
                        functie: function(expr) {
                            if (expr.name == 'Times') {
                                if (expr.args.some(s => s.value == 1)) {
                                    console.log('bevat product met 1');
                                    newfactors = [];
                                    expr.args.forEach(factor => {if (factor.value != 1) {console.log('notone =' + factor.toString()); newfactors.push(factor)}});
                                    newexp = makeMulti('Times', newfactors);
                                    console.log('newexp =' + newexp.toString());
                                    return newexp;
                                }
                            }
                        
                        }

                    },
                    schrapUnitaireBreuk: {
                        naam: 'schrap unitaire breuk',
                        input: {
                            expr: math.parse('a/a'),
                            unknowns: ['a']
                        },
                        output: {
                            expr: math.parse('1'),
                            unknowns: []
                        }
                    },
                    omgekeerdeIsInverseVoorMaal1: {
                        naam: 'omgekeerde is inverse voor maal',
                        input: {
                            expr: math.parse('Times(a,1/a)'),
                            unknowns: ['a']
                        },
                        output: {
                            expr: math.parse('1'),
                            unknowns: []
                        }
                    },
                    omgekeerdeIsInverseVoorMaal2: {
                        naam: 'omgekeerde is inverse voor maal',
                        input: {
                            expr: math.parse('Times(1/a,a)'),
                            unknowns: ['a']
                        },
                        output: {
                            expr: math.parse('1'),
                            unknowns: []
                        }
                    },
                    breukenVermenigvuldigen: {
                        naam: 'breuken vermenigvuldigen',
                        input: {
                            expr: math.parse('Times(a/b,c/d)'),
                            unknowns: ['a', 'b', 'c', 'd']
                        },
                        output: {
                            expr: math.parse('Times(a,c)/Times(b,d)'),
                            unknowns: ['a', 'b', 'c', 'd']
                        },
                        functie: function(expr) {
                            if (expr.name == 'Times') {
                                if (expr.args.every(s => s.fn == 'divide')) {
                                    console.log('bevat enkel breuken');
                                    tellerArgs = [];
                                    noemerArgs = [];
                                    expr.args.forEach(breuk => {
                                        tellerArgs.push(breuk.args[0]);
                                        noemerArgs.push(breuk.args[1]);
                                    } );
                                    teller = makeMulti('Times', tellerArgs);
                                    noemer = makeMulti('Times', noemerArgs);
                                    newexp = new math.expression.node.OperatorNode("/", "divide", [teller, noemer]);
                                    console.log('newexp =' + newexp.toString());
                                    return newexp;
                                }
                            }
                        
                        }

                        
                    },
                    uiteenTrekRegel: {
                        naam: 'breuk in factoren uit elkaar trekken (eerste breuk eraf trekken)',
                        input: {
                            expr: math.parse('Times(a,c)/Times(b,d)'),
                            unknowns: ['a', 'b', 'c', 'd']
                        },
                        output: {
                            expr: math.parse('Times(a/b,c/d)'),
                            unknowns: ['a', 'b', 'c', 'd']
                        },
                        functie: function(expr) {
                            if (expr.fn == 'divide') {
                                if (expr.args.every(s => s.name == 'Times')) {
                                    console.log('breuk bestaat uit producten');
                                    teller = expr.args[0];
                                    noemer = expr.args[1];
                                    eersteBreuk = new math.expression.node.OperatorNode("/", "divide", [teller.args[0], noemer.args[0]]);
                                    tweedeTeller = makeMulti('Times',teller.args.slice(1,));
                                    tweedeNoemer = makeMulti('Times',noemer.args.slice(1));
                                    tweedeBreuk = new math.expression.node.OperatorNode("/", "divide", [tweedeTeller, tweedeNoemer]);

                                    newexp = makeMulti('Times', [eersteBreuk,tweedeBreuk]);
                                    console.log('newexp =' + newexp.toString());
                                    return newexp;
                                }
                            }
                        
                        }
                    },
                    eenheidsbreukAlsMinEenExponent: {
                        naam: 'eenheidsbreuk als negatieve exponent',
                        input: {
                            expr: math.parse('1/a'),
                            unknowns: ['a']
                        },
                        output: {
                            expr: math.parse('pow(a,unaryMinus(1))'),
                            unknowns: ['a']
                        }
                    },
                    minEenExponentAlsEenheidsbreuk: {
                        naam: 'negatieve exponent als eenheidsbreuk',
                        input: {
                            expr: math.parse('pow(a,unaryMinus(1))'),
                            unknowns: ['a']
                        },
                        output: {
                            expr: math.parse('1/a'),
                            unknowns: ['a']
                        }
                    },

                    eenheidsbreukAlsNegatieveExponent: {
                        naam: 'eenheidsbreuk als negatieve exponent',
                        input: {
                            expr: math.parse('1/pow(a,n)'),
                            unknowns: ['a','n']
                        },
                        output: {
                            expr: math.parse('pow(a,unaryMinus(n))'),
                            unknowns: ['a','n']
                        }
                    },

                    negatieveExponentAlsEenheidsbreuk: {
                        naam: 'negatieve exponent als eenheidsbreuk',
                        input: {
                            expr: math.parse('pow(a,unaryMinus(n))'),
                            unknowns: ['a','n']
                        },
                        output: {
                            expr: math.parse('1/pow(a,n)'),
                            unknowns: ['a','n']
                        }
                    },


                    vermenigvuldigingMetEenheidsbreuk: {
                        naam: 'vermenigvuldiging met eenheidsbreuk geeft breuk (dyadisch)',
                        input: {
                            expr: math.parse('Times(a,1/b)'),
                            unknowns: ['a', 'b']
                        },
                        output: {
                            expr: math.parse('a/b'),
                            unknowns: ['a', 'b']
                        },
                        functie: function(expr) {
                            if (expr.name == 'Times') {
                                if (expr.args.some(s => s.fn == 'divide' && s.args[0]==1)) {
                                    console.log('product bevat eenheidsbreuk');
                                    if (expr.args.length == 2) {
                                        expr.args.forEach(factor => factor.fn == 'divide' ? eenheidsBreuk = factor : andereFactor = factor);

                                    }

                                    newexp = new math.expression.node.OperatorNode("/", "divide", [andereFactor, eenheidsBreuk.args[1]]);
                                    console.log('newexp =' + newexp.toString());
                                    return newexp;
                                }
                            }
                        
                        }
                    },
                    vermenigvuldigingGetalMetEenheidsbreuk: {
                        naam: 'vermenigvuldiging getal met eenheidsbreuk geeft breuk',
                        input: {
                            expr: math.parse('Times(a/b,c)'),
                            unknowns: ['a', 'b', 'c']
                        },
                        output: {
                            expr: math.parse('Times(a,c)/b'),
                            unknowns: ['a', 'b','c']
                        },
                        //  TODO oorspronkelijke volgorde van breuk en andere factor respecteren in output
                        functie: function(expr) {
                            if (expr.name == 'Times') {
                                if (expr.args.some(s => s.fn == 'divide')) {
                                    console.log('product bevat breuk');
                                    if (expr.args.length == 2) {
                                        expr.args.forEach(factor => factor.fn == 'divide' ? breuk = factor : andereFactor = factor);
                                       console.log('breuk = ' + breuk.toString());
                                       console.log('andere factor = ' + andereFactor.toString());
                                        if (andereFactor.type != 'OperatorNode' && andereFactor.fn != 'divide') {
                                            console.log('andere Factor is geen operatornode');
                                            nieuweTeller = makeMulti('Times', [breuk.args[0] , andereFactor]);
                                            newexp = new math.expression.node.OperatorNode("/", "divide", [nieuweTeller, breuk.args[1]]);
                                            console.log('newexp =' + newexp.toString());
                                            return newexp;
                                        }
                                    }

                            
                                }
                            }
                        
                        }
                    },
                    simpeleBreukUitElkaarTrekken: {
                        naam: 'breuk als getal maal eenheidsbreuk',
                        input: {
                            expr: math.parse('a/b'),
                            unknowns: ['a', 'b']
                        },
                        output: {
                            expr: math.parse('Times(a,1/b)'),
                            unknowns: ['a', 'b']
                        }
                    },
                    // vermenigvuldigingMetEenLinks: {
                    //     naam: '1 is neutraal voor vermenigvuldiging',
                    //     input: {
                    //         expr: math.parse('Times(1,a)'),
                    //         unknowns: ['a']
                    //     },
                    //     output: {
                    //         expr: math.parse('a'),
                    //         unknowns: ['a']
                    //     }
                    // },
                    // vermenigvuldigingMetEenRechts: {
                    //     naam: '1 is neutraal voor vermenigvuldiging',
                    //     input: {
                    //         expr: math.parse('Times(a,1)'),
                    //         unknowns: ['a']
                    //     },
                    //     output: {
                    //         expr: math.parse('a'),
                    //         unknowns: ['a']
                    //     }
                    // },
                    vermenigvuldigingMetNul: {
                        naam: '0 is opslorpend voor vermenigvuldiging',
                        input: {
                            expr: math.parse('Times(0, a)'),
                            unknowns: ['a']
                        },
                        output: {
                            expr: math.parse('a'),
                            unknowns: ['a']
                        },
                        functie: function(expr) {
                            if (expr.name == 'Times') {
                                if (expr.args.some(s => s.value == 0)) {
                                    console.log('bevat factor met 0');
                                    newexp = new math.expression.node.ConstantNode(0);
                                    return newexp;
                                }
                            }
                        }
                    },
                    // vermenigvuldigingMetNulRechts: {
                    //     naam: '0 is neutraal voor vermenigvuldiging',
                    //     input: {
                    //         expr: math.parse('Times(a,0)'),
                    //         unknowns: ['a']
                    //     },
                    //     output: {
                    //         expr: math.parse('a'),
                    //         unknowns: ['a']
                    //     }
                    // },
                    wortelInversAanMacht: {
                        naam: 'wortel heft een macht op',
                        input: {
                            expr: math.parse('nthRoot(pow(a,b),b)'),
                            unknowns: ['a','b']
                        },
                        output: {
                            expr: math.parse('a'),
                            unknowns: ['a']
                        }
                    },
                    machtInversAanWortel: {
                        naam: 'macht heft een wortel op',
                        input: {
                            expr: math.parse('pow(nthRoot(a,b),b)'),
                            unknowns: ['a','b']
                        },
                        output: {
                            expr: math.parse('a'),
                            unknowns: ['a']
                        }
                    },
                    exponentenOptellen: {
                        naam: 'product van machten (= zelfde basis) telt exponenten op',
                        input: {
                            expr: math.parse('Times(pow(x,a),pow(x,b))'),
                            unknowns: ['x','a','b']
                        },
                        output: {
                            expr: math.parse('pow(x,Plus(a,b))'),
                            unknowns: ['x','a','b']
                        },
                        functie: function(expr) {
                            if (expr.name == 'Times') {
                                baseArray = [];
                                exponentArray = [];
                                one = math.parse('1');
                                expr.args.forEach(factor => {
                                    if (factor.name == 'pow') {
                                        baseArray.push(factor.args[0]);
                                         exponentArray.push(factor.args[1]);
                                    } else { 
                                        baseArray.push(factor);
                                        exponentArray.push(one);
                                    }
                                });
                                base = baseArray[0];
                                if (baseArray.every(s => s.equals(base))) {
                                    console.log('good one');
                                    // console.log(exponentArray);
                                    zonderOnes = [];
                                    i = 0;
                                    exponentArray.forEach(exp => {if (exp.equals(one)) {i++} else {zonderOnes.push(exp)} });
                                    // als het allemaal eentjes zijn tellen we ze ineens op (als enige exponent)
                                    if (0 == zonderOnes.length) {
                                        exponentArray = [math.parse(String(i))];
                                    };
                                    exponent = makeMulti('Plus', exponentArray);
                                    return new math.expression.node.FunctionNode("pow", [base,exponent]);
                                }
                            }
                           
                        }
                    },
                    somVanExponentenNaarVermenigvuldiging: {
                        naam: 'opgetelde exponenten schrijven als een vermenigvuldiging',
                        input: {
                            expr: math.parse('pow(x,Plus(a,b))'),
                            unknowns: ['x','a','b']
                        },
                        output: {
                            expr: math.parse('Times(pow(x,a),pow(x,b))'),
                            unknowns: ['x','a','b']
                        },
                        functie: function(expr) {
                            if (expr.name == 'pow' && expr.args[1].name == "Plus") {
                                console.log('good one');
                                base = expr.args[0];
                                exponentArray = expr.args[1].args;
                                machtArray = exponentArray.map(exponent => new math.expression.node.FunctionNode("pow", [base,exponent]) )
                                return makeMulti('Times', machtArray);
                            }
                        }
                    },
                    machtTorenAfbreken: {
                        naam: 'machttoren afbreken',
                        input: {
                            expr: math.parse('pow(pow(x,a),b)'),
                            unknowns: ['x','a','b']
                        },
                        output: {
                            expr: math.parse('pow(x,Times(a,b))'),
                            unknowns: ['x','a','b']
                        }
                    },
                    machtTorenOpbouwen: {
                        naam: 'machttoren opbouwen',
                        input: {
                            expr: math.parse('pow(x,Times(a,b))'),
                            unknowns: ['x','a','b']
                        },
                        output: {
                            expr: math.parse('pow(pow(x,a),b)'),
                            unknowns: ['x','a','b']
                        },
                        functie: function(expr) {
                            if (expr.name == 'pow' && expr.args[1].name == "Times") {
                                console.log('good one');
                                base = expr.args[0];
                                exponentArray = expr.args[1].args;
                                lastExponent = exponentArray.pop();
                                restProduct = makeMulti('Times', exponentArray);
                                newBase = new math.expression.node.FunctionNode('pow', [base,restProduct]);
                                newexpr = new math.expression.node.FunctionNode('pow', [newBase,lastExponent]);
                                return newexpr;
                            }
                        }
                    },
                    machtNaarWortelNotatie: {
                        naam: 'macht als wortel schrijven',
                        input: {
                            expr: math.parse('pow(x,p/q)'),
                            unknowns: ['x','p','q']
                        },
                        output: {
                            expr: math.parse('nthRoot(pow(x,p),q)'),
                            unknowns: ['x','p','q']
                        }
                    },
                    wortelNaarMachtNotatie1: {
                        naam: 'wortel als macht schrijven',
                        input: {
                            expr: math.parse('nthRoot(pow(x,p),q)'),
                            unknowns: ['x','p','q']
                        },
                        output: {
                            expr: math.parse('pow(x,p/q)'),
                            unknowns: ['x','p','q']
                        }
                    },
                    wortelNaarMachtNotatie2: {
                        naam: 'wortel als macht schrijven',
                        input: {
                            expr: math.parse('pow(nthRoot(x,q),p)'),
                            unknowns: ['x','p','q']
                        },
                        output: {
                            expr: math.parse('pow(x,p/q)'),
                            unknowns: ['x','p','q']
                        }
                    },
                    wortelNaarMachtNotatie3: {
                        naam: 'wortel als macht schrijven',
                        input: {
                            expr: math.parse('nthRoot(x,q)'),
                            unknowns: ['x','q']
                        },
                        output: {
                            expr: math.parse('pow(x,1/q)'),
                            unknowns: ['x','q']
                        }
                    },
                   
                    machtVanProduct: {
                        naam: 'macht van een product',
                        input: {
                            expr: math.parse('pow(Times(x,y),n)'),
                            unknowns: ['x','y','n']
                        },
                        output: {
                            expr: math.parse('Times(pow(x,n),pow(y,n))'),
                            unknowns: ['x','y','n']
                        },
                        functie: function(expr) {
                            if (expr.name == 'pow' && expr.args[0].name == "Times") {
                                console.log('good one');
                                exponent = expr.args[1];
                                baseArray = expr.args[0].args;
                                machtArray = baseArray.map(base => new math.expression.node.FunctionNode("pow", [base,exponent]) )
                                return makeMulti('Times', machtArray);
                            }

                        }
                    },
                     
                    productMetGelijkeExponenten: {
                        naam: 'product met gelijke exponenten',
                        input: {
                            expr: math.parse('Times(pow(x,n),pow(y,n))'),
                            unknowns: ['x','y','n']
                        },
                        output: {
                            expr: math.parse('pow(Times(x,y),n)'),
                            unknowns: ['x','y','n']
                        },
                       
                        functie: function(expr) {
                            if (expr.name == 'Times') {
                                
                                if (expr.args.every(factor => factor.fn == 'pow')) {
                                    console.log('good one');
                                    baseArray = [];
                                    exponent = expr.args[0].args[1];
                                    expr.args.forEach( factor => {if (factor.args[1].equals(exponent)) {baseArray.push(factor.args[0])} });
                                    console.log('aantal gelijke exp = ' + baseArray.length);
                                    // powArray = baseArray.map( base => new math.expression.node.FunctionNode('pow', [base, exponent]));
                                    if (baseArray.length === expr.args.length) {
                                       product = makeMulti('Times', baseArray);
                                       macht = new math.expression.node.FunctionNode('pow', [product, exponent]);
                                       console.log('macht = ' + macht.toString());
                                       return macht;
                                    }
                                }
                            }
                         
                        }

              
                    },
                    // optellenMetNulLinksDoetNiks: {
                    //     naam: 'optellen met nul langs links',
                    //     input: {
                    //         expr: math.parse('Plus(0,a)'),
                    //         unknowns: ['a']
                    //     },
                    //     output: {
                    //         expr: math.parse('a'),
                    //         unknowns: ['a']
                    //     }
                    // },
                    // optellenMetNulRechtsDoetNiks: {
                    //     naam: 'optellen met nul langs rechts',
                    //     input: {
                    //         expr: math.parse('Plus(a,0)'),
                    //         unknowns: ['a']
                    //     },
                    //     output: {
                    //         expr: math.parse('a'),
                    //         unknowns: ['a']
                    //     }
                    // },

                    productVanGelijkeWortels: {
                        naam: 'product van gelijke wortels',
                        input: {
                            expr: math.parse('Times(nthRoot(x,n),nthRoot(y,n))'),
                            unknowns: ['x','y','n']
                        },
                        output: {
                            expr: math.parse('nthRoot(Times(x,y),n)'),
                            unknowns: ['x','y','n']
                        },
                        functie: function(expr) {
                            if (expr.name == 'Times') {
                                
                                if (expr.args.every(factor => factor.fn == 'nthRoot')) {
                                    console.log('good one');
                                    baseArray = [];
                                    n = expr.args[0].args[1];
                                    expr.args.forEach( factor => {if (factor.args[1].equals(n)) {baseArray.push(factor.args[0])} });
                                    console.log('aantal gelijke exp = ' + baseArray.length);
                                   
                                    if (baseArray.length === expr.args.length) {
                                       product = makeMulti('Times', baseArray);
                                       wortel = new math.expression.node.FunctionNode("nthRoot", [product, n]);

                                    //    parsewortel = math.parse("nthRoot(a,b)");
                                    //    parsewortel.args[0] = product;
                                    //    parsewortel.args[1] = n;
                                       
                                       console.log('wortel = ' + wortel.toString());
                                       return wortel;

                                    // console.log('parsewortel = ' + parsewortel.toString());
                                    //    return parsewortel;
                                    }
                                }
                            }
                         
                        },

                                       
                        
                        
                    },
                     
                    productOnderDeWortel: {
                        naam: 'product onder de wortel',
                        input: {
                            expr: math.parse('nthRoot(Times(x,y),n)'),
                            unknowns: ['x','y','n']
                        },
                        output: {
                            expr: math.parse('Times(nthRoot(x,n),nthRoot(y,n))'),
                            unknowns: ['x','y','n']
                        },
                        functie: function(expr) {
                            if (expr.name == 'nthRoot') {
                                
                                if (expr.args[0].name == 'Times') {
                                    console.log('good one');
                                    factorArray = expr.args[0].args;
                                    n = expr.args[1];
                                       wortelArray = factorArray.map(factor => new math.expression.node.FunctionNode("nthRoot", [factor, n]))
                                       product = makeMulti('Times', wortelArray);
                                       console.log('product = ' + product.toString());
                                       return product;
                                    
                                }
                            }
                        }
                    },
                    wortelVanBreuk: {
                        naam: 'wortel van een breuk',
                        input: {
                            expr: math.parse('nthRoot(x/y,n)'),
                            unknowns: ['x','y','n']
                        },
                        output: {
                            expr: math.parse('nthRoot(x,n)/nthRoot(y,n)'),
                            unknowns: ['x','y','n']
                        }
                    },
                    breukVanWortels: {
                        naam: 'breuk van wortels',
                        input: {
                            expr: math.parse('nthRoot(x,n)/nthRoot(y,n)'),
                            unknowns: ['x','y','n']
                        },
                        output: {
                            expr: math.parse('nthRoot(x/y,n)'),
                            unknowns: ['x','y','n']
                        }
                    },
                     // TODO functie voor schrijven
                    binomium2Expand: {
                        naam: 'merkwaardig kwadraat uitwerken',
                        input: {
                            expr: math.parse('pow(Plus(a,b),2)'),
                            unknowns: ['a','b']
                        },
                        output: {
                            expr: math.parse('Plus(pow(a,2),Times(2,a,b), pow(b,2))'),
                            unknowns: ['a','b']
                        }
                    },
                     // TODO functie voor schrijven zodat het niet langere plussen meeherkent!
                    binomium2Factor: {
                        naam: 'merkwaardig kwadraat herkennen',
                        input: {
                            expr: math.parse('Plus(pow(a,2),Times(2,a,b), pow(b,2))'),
                            unknowns: ['a','b']
                        },
                        output: {
                            expr: math.parse('pow(Plus(a,b),2)'),
                            unknowns: ['a','b']
                        }
                    },
                     // TODO functie voor schrijven
                    binomium3Expand: {
                        naam: 'merkwaardige derdemacht uitwerken',
                        input: {
                            expr: math.parse('pow(Plus(a,b),3)'),
                            unknowns: ['a','b']
                        },
                        output: {
                            expr: math.parse('Plus(pow(a,3),Times(3,pow(a,2),b),Times(3,a,pow(b,2)), pow(b,3))'),
                            unknowns: ['a','b']
                        }
                    },
                     // TODO functie voor schrijven
                    binomium3Factor: {
                        naam: 'merkwaardig derde macht herkennen',
                        input: {
                            expr: math.parse('Plus(pow(a,3),Times(3,pow(a,2),b),Times(3,a,pow(b,2)), pow(b,3))'),
                            unknowns: ['a','b']
                        },
                        output: {
                            expr: math.parse('pow(Plus(a,b),3)'),
                            unknowns: ['a','b']
                        }
                    },
                     // TODO functie voor schrijven
                    verschilVanKwadratenExpand: {
                        naam: 'verschil van kwadraten uitwerken',
                        input: {
                            expr: math.parse('Plus(pow(a,2),unaryMinus(pow(b,2)))'),
                            unknowns: ['a','b']
                        },
                        output: {
                            expr: math.parse('Times(Plus(a,b),Plus(a,unaryMinus(b)))'),
                            unknowns: ['a','b']
                        }
                    },
                     // TODO functie voor schrijven
                    verschilVanKwadratenExpand1: {
                        naam: 'verschil van kwadraten herkennen',
                        input: {
                            expr: math.parse('Times(Plus(a,b),Plus(a,unaryMinus(b)))'),
                            unknowns: ['a','b']
                        },
                        output: {
                            expr: math.parse('Plus(pow(a,2),unaryMinus(pow(b,2)))'),
                            unknowns: ['a','b']
                        }
                    },
                     // TODO functie voor schrijven
                    verschilVanKwadratenExpand2: {
                        naam: 'verschil van kwadraten herkennen',
                        input: {
                            expr: math.parse('Times(Plus(a,unaryMinus(b)),Plus(a,b))'),
                            unknowns: ['a','b']
                        },
                        output: {
                            expr: math.parse('Plus(pow(a,2),unaryMinus(pow(b,2)))'),
                            unknowns: ['a','b']
                        }
                    },
                    eersteMachtNeutraal: {
                        naam: 'eerste macht doet niks',
                        input: {
                            expr: math.parse('pow(a,1)'),
                            unknowns: ['a']
                        },
                        output: {
                            expr: math.parse('a'),
                            unknowns: ['a']
                        }
                    },
                    nuldeMachtIsEen: {
                        naam: 'nulde macht is 1',
                        input: {
                            expr: math.parse('pow(a,0)'),
                            unknowns: ['a']
                        },
                        output: {
                            expr: math.parse('1'),
                            unknowns: ['a']
                        }
                    },
                    BreukAlsVerschilVanExponenten: {
                        naam: 'breuk van machten is het verschil van exponenten',
                        input: {
                            expr: math.parse('pow(a,n)/pow(a,m)'),
                            unknowns: ['a','n','m']
                        },
                        output: {
                            expr: math.parse('pow(a,n-m)'),
                            unknowns: ['a','n','m']
                        }
                    },

                    nulDelenDoorIets: {
                        naam: 'nul delen door iets is nul',
                        input: {
                            expr: math.parse('0/a'),
                            unknowns: ['a']
                        },
                        output: {
                            expr: math.parse('0'),
                            unknowns: []
                        }
                    },
        
                    factorBuitenhalen: {
                        naam: 'factor buitenhalen',
                        input: {
                            expr: math.parse('Plus(a,b)'),
                            unknowns: ['a','b']
                        },
                        output: {
                            expr: math.parse('Times(c,Plus(a/c,b/c))'),
                            unknowns: ['a','b']
                        },
                        functie: function(expr) {
                            
                            if (expr.name == 'Plus') {
                                
                                    console.log('good one');
                                    generatorArray = [];
                                    divisor = math.parse('c');
                                    newTermsArray = expr.args.map(term => new math.expression.node.OperatorNode("/", "divide", [term, divisor]));
                                    newPlus = makeMulti('Plus', newTermsArray);
        
                                    return makeMulti('Times', [divisor, newPlus]);
                                
                            }
                        
                        },
                        extraEquation: math.parse('c==Select(c)')
                    },

                    productAlsMacht: {
                        naam: 'gelijke factoren als een macht schrijven met functie',
                        input: {
                            expr: [],
                            unknowns: [],

                        },
                        output: {
                            expr: [],
                            unknowns: [],
                        },
                        functie: function(expr) {
                            if (expr.name == 'Times') {
                                base = expr.args[0];
                                if (expr.args.every( factor => factor.equals(base))) {
                                    console.log('good one');
                                    exponent = expr.args.length;
                                    console.log('exponent = '+ exponent);
                                    console.log('base = ' + base.toString());
                                    return new math.expression.node.FunctionNode('pow', [base, math.parse(exponent)]);

                                }
                            }
                         
                        }

                    },

                    brengLinkseFactorBinnenMetFunctie: {
                        naam: 'factor langs links binnen multiplus brengen met functie',
                        input: {
                            expr: [],
                            unknowns: [],

                        },
                        output: {
                            expr: [],
                            unknowns: [],
                        },
                        functie: function(expr) {
                            if (expr.name == 'Times') {
                                if (expr.args[1].name == 'Plus') {
                                    console.log('good one');
                                    generatorArray = expr.args;
                                    console.log(generatorArray);
                                    combos = oneCombinations(generatorArray);
                                    return makeMulti('Plus', combos.map(paar => makeMulti('Times', paar)));

                                }
                            }
                            // return math.parse('Times(l,o,l)');
                        }

                    },

                    expandDoorMetFunctie: {
                        naam: 'product van multiplussen terugbrengen tot lange som met functie',
                        input: {
                            expr: [],
                            unknowns: [],

                        },
                        output: {
                            expr: [],
                            unknowns: [],
                        },
                        functie: function(expr) {
                            if (expr.name == 'Times') {
                                if (expr.args.some(s => s.name == 'Plus')) {
                                    console.log('good one');
                                    generatorArray = [];
                                    expr.args.forEach(factor => (factor.name == 'Plus') ? generatorArray.push(factor.args) : generatorArray.push(factor));
                                    console.log(generatorArray);
                            //  TODO: vervang oneCombinations hier door nCombinations!
                                    combos = oneCombinations(generatorArray);
                                    return makeMulti('Plus', combos.map(paar => makeMulti('Times', paar)));

                                }
                            }
                            return math.parse('Times(l,o,l)');
                        }

                    },

                    vergelijkingNegeren: {
                        naam: 'negeer vergelijking',
                        input: {
                            expr: math.parse('a==b'),
                            unknowns: ['a','b']
                        },
                        output: {
                            expr: math.parse('a==b'),
                            unknowns: ['a','b']
                        },
                        functie: function(expr) {
                            if (expr.fn == 'equal') {
                                return math.parse("vgl dus gn omvorm");
                            }

                        }
                    },                    

                    nulBijtellen: {
                        naam: 'nul bijtellen',
                        input: {
                            expr: math.parse('a'),
                            unknowns: ['a']
                        },
                        output: {
                            expr: math.parse('Plus(a,0)'),
                            unknowns: ['a']
                        }
                    },

                    aGedeeldDoorA: {
                        naam: 'a delen door a is 1',
                        input: {
                            expr: math.parse('a/a'),
                            unknowns: ['a']
                        },
                        output: {
                            expr: math.parse('1'),
                            unknowns: []
                        }
                    },                    
                    
                    
                };

                simplificatieregels = [
                    'nulNeutraalVoorPlus',
                    'eenNeutraalVoorMaal',
                    'schrapUnitaireBreuk',
                    'nulDelenDoorIets',
                    'omgekeerdeIsInverseVoorMaal1',
                    'omgekeerdeIsInverseVoorMaal2',
                    'vermenigvuldigingMetNul',
                    'machtInversAanWortel',
                    'wortelInversAanMacht',
                    'nuldeMachtIsEen',
                    'BreukAlsVerschilVanExponenten',
                    'aGedeeldDoorA'
                ];

                spaceregels = [
                    'breukenVermenigvuldigen',
                    'uiteenTrekRegel',
                    'minEenExponentAlsEenheidsbreuk',
                    'eenheidsbreukAlsMinEenExponent',
                    'eenheidsbreukAlsNegatieveExponent',
                    'negatieveExponentAlsEenheidsbreuk',
                    'vermenigvuldigingMetEenheidsbreuk',
                    'vermenigvuldigingGetalMetEenheidsbreuk',
                    'simpeleBreukUitElkaarTrekken',
                    'exponentenOptellen',
                    'somVanExponentenNaarVermenigvuldiging',
                    'machtTorenAfbreken',
                    'machtTorenOpbouwen',
                    'machtNaarWortelNotatie',
                    'wortelNaarMachtNotatie1',
                    'wortelNaarMachtNotatie2',
                    'wortelNaarMachtNotatie3',
                    'machtVanProduct',
                    'productMetGelijkeExponenten',
                    'productOnderDeWortel',
                    'productVanGelijkeWortels',
                    'breukVanWortels',
                    'wortelVanBreuk',
                    'binomium2Expand',
                    'binomium2Factor',
                    'binomium3Expand',
                    'binomium3Factor',
                    'verschilVanKwadratenExpand',
                    'verschilVanKwadratenExpand1',
                    'verschilVanKwadratenExpand2',
                    'factorBuitenhalen'

                ];

                naargetalregels = [
                    'vergelijkingNegeren',
                    'aMinA',
                    'nulNeutraalVoorPlus',
                    'eenNeutraalVoorMaal',
                    'schrapUnitaireBreuk',
                    'wortelInversAanMacht',
                    'machtInversAanWortel',
                    'omgekeerdeIsInverseVoorMaal1',
                    'omgekeerdeIsInverseVoorMaal2',
                    'vermenigvuldigingMetNul',
                    'nuldeMachtIsEen',
                    'aGedeeldDoorA',
                    'nulDelenDoorIets',

                ];

                naarplusregels = [
                    'vergelijkingNegeren',
                    'binomium2Expand',
                    'binomium3Expand',
                    'verschilVanKwadratenExpand1',
                    'verschilVanKwadratenExpand2',
                    'brengLinkseFactorBinnenMetFunctie',
                    'nulBijtellen'
                ];

                naartimesregels = [
                    'vergelijkingNegeren',
                    'machtVanProduct',
                    'productOnderDeWortel',
                    'uiteenTrekRegel',
                    'simpeleBreukUitElkaarTrekken',
                    // 'vermenigvuldigingMetEenheidsbreukOmgekeerd',
                    // TODO vermenigvuldigingMetEenheidsbreukOmgekeerd maken
                    'somVanExponentenNaarVermenigvuldiging',
                    'verschilVanKwadratenExpand',
                    'factorBuitenhalen',
                    
                ];

                naarminregels = [
                    'vergelijkingNegeren'
                ];

                naarbreukregels = [
                    'vergelijkingNegeren',
                    'breukenVermenigvuldigen',
                    'minEenExponentAlsEenheidsbreuk',
                    'negatieveExponentAlsEenheidsbreuk',
                    'vermenigvuldigingMetEenheidsbreuk',
                    'vermenigvuldigingGetalMetEenheidsbreuk',
                    'wortelVanBreuk'
                ];

                naarmachtregels = [
                    'vergelijkingNegeren',
                    'eenheidsbreukAlsMinEenExponent',
                    'eenheidsbreukAlsNegatieveExponent',
                    'productAlsMacht',
                    'exponentenOptellen',
                    'productMetGelijkeExponenten',
                    'wortelNaarMachtNotatie1',
                    'wortelNaarMachtNotatie2',
                    'wortelNaarMachtNotatie3'
                ];

                naarexpregels = [
                    'vergelijkingNegeren'
                ];

                naarwortelregels = [
                    'vergelijkingNegeren',
                    'productVanGelijkeWortels',
                    'breukVanWortels'
                ]

                naarlogregels = [
                    'vergelijkingNegeren'
                ];



                multiFunction = {
                    'Times': 1,
                    'Plus': 1,
                    'And': 1,
                    'Or': 1,
                    'add': 1,
                    'multiply': 1
                };

                var equation = math.parse('');

                var keysList = [];

                updateLatex(equation);

// om toch maar iets in de regelbox te schrijven
                regelString1 = "Times(a,Plus(b,c))==Plus(Times(a,b),Times(a,c))";
                regelNode1 = math.parse(regelString1);
                var latex = regelNode1.toTex({
                   parenthesis: parenthesis,
                    implicit: implicit
                       });
                var largeLatex = "\\large " + latex;
                    katex.render(largeLatex, regel1);
// einde toch maar iets in regelbox schrijven

                // wat er gebeurt als je iets rechtstreeks invult in de expressiebox
                expr.oninput = function () {

                    equation = math.parse(expr.value)
                    updateLatex(equation);

                }



                ///*********************************************************************
                ///  Keyboard handling
                ///*********************************************************************

                var keyboardlookups = {
                    wouterCodeNumpad: {
                        ArrowLeft: 'left',
                        ArrowUp: 'up',
                        ArrowRight: 'right',
                        ArrowDown: 'down',

                        Minus: 'minus',
                        Equal: 'plus',
                        BracketLeft: 'divide',
                        BracketRight: 'times',
                        Quote: 'nthroot',
                        Backslash: 'power',
                        Slash: 'equals',

                        Space: 'space',
                        Tab: 'tab',
                        Escape: 'escape',
                        Enter: 'enter',
                        Backquote: 'apestaart',
                        Backspace: 'backspace',

                        NumpadSubtract: 'minus',
                        NumpadAdd: 'plus',
                        NumpadDivide: 'divide',
                        NumpadMultiply: 'times',
                        NumpadEnter: 'enter',
                        Quote: 'nthroot',
                        Backslash: 'power',
                        Slash: 'equals',

                        F1: 'f1',
                        F2: 'f2',
                        F3: 'f3',
                        F4: 'f4',
                        F5: 'f5',
                        F6: 'f6',
                        F7: 'f7',
                        F8: 'f8',
                        F9: 'f9',
                        F10: 'f10',
                        F11: 'f11',
                        F12: 'f12',

                        Digit0: '0',
                        Digit1: '1',
                        Digit2: '2',
                        Digit3: '3',
                        Digit4: '4',
                        Digit5: '5',
                        Digit6: '6',
                        Digit7: '7',
                        Digit8: '8',
                        Digit9: '9',

                        Numpad0: '0',
                        Numpad1: '1',
                        Numpad2: '2',
                        Numpad3: '3',
                        Numpad4: '4',
                        Numpad5: '5',
                        Numpad6: '6',
                        Numpad7: '7',
                        Numpad8: '8',
                        Numpad9: '9',

                        KeyA: 'a',
                        KeyB: 'b',
                        KeyC: 'c',
                        KeyD: 'd',
                        KeyE: 'e',
                        KeyF: 'f',
                        KeyG: 'g',
                        KeyH: 'h',
                        KeyI: 'i',
                        KeyJ: 'j',
                        KeyK: 'k',
                        KeyL: 'l',
                        KeyM: 'm',
                        KeyN: 'n',
                        KeyO: 'o',
                        KeyP: 'p',
                        KeyQ: 'q',
                        KeyR: 'r',
                        KeyS: 's',
                        KeyT: 't',
                        KeyU: 'u',
                        KeyV: 'v',
                        KeyW: 'w',
                        KeyX: 'x',
                        KeyY: 'y',
                        KeyZ: 'z'

                    }
                }

                var keyboards = {
                    wouterkeyCode: {
                        left: 37,
                        up: 38,
                        right: 39,
                        down: 40,

                        minus: 169,
                        plus: 173,
                        divide: 160,
                        times: 164,
                        nthroot: 165,
                        power: 192,
                        equals: 61,


                        0: 48,
                        1: 49,
                        2: 50,
                        3: 51,
                        4: 52,
                        5: 53,
                        6: 54,
                        7: 55,
                        8: 56,
                        9: 57,

                        a: 65,
                        b: 66,
                        c: 67

                    },
                    svenkeyCode: {
                        left: 37,
                        up: 38,
                        right: 39,
                        down: 40,

                        minus: 219,
                        plus: 189,
                        divide: 221,
                        times: 186,
                        nthroot: 192,
                        power: 220,
                        equals: 187,


                        0: 48,
                        1: 49,
                        2: 50,
                        3: 51,
                        4: 52,
                        5: 53,
                        6: 54,
                        7: 55,
                        8: 56,
                        9: 57,

                        a: 65,
                        b: 66,
                        c: 67
                    },
                    wouterCode: {
                        left: 'ArrowLeft',
                        up: 'ArrowUp',
                        right: 'ArrowRight',
                        down: 'ArrowDown',

                        minus: 'Minus',
                        plus: 'Equal',
                        divide: 'BracketLeft',
                        times: 'BracketRight',
                        nthroot: 'Quote',
                        power: 'Backslash',
                        equals: 'Slash',

                        space: 'Space',
                        tab: 'Tab',
                        escape: 'Escape',
                        enter: 'Enter',
                        apestaart: 'Backquote',
                        backspace: 'Backspace',

                        f1: 'F1',
                        f2: 'F2',
                        f3: 'F3',
                        f4: 'F4',
                        f5: 'F5',
                        f6: 'F6',
                        f7: 'F7',
                        f8: 'F8',
                        f9: 'F9',
                        f10: 'F10',
                        f11: 'F11',
                        f12: 'F12',


                        0: 'Digit0',
                        1: 'Digit1',
                        2: 'Digit2',
                        3: 'Digit3',
                        4: 'Digit4',
                        5: 'Digit5',
                        6: 'Digit6',
                        7: 'Digit7',
                        8: 'Digit8',
                        9: 'Digit9',

                        a: 'KeyA',
                        b: 'KeyB',
                        c: 'KeyC',
                        d: 'KeyD',
                        e: 'KeyE',
                        f: 'KeyF',
                        g: 'KeyG',
                        h: 'KeyH',
                        i: 'KeyI',
                        j: 'KeyJ',
                        k: 'KeyK',
                        l: 'KeyL',
                        m: 'KeyM',
                        n: 'KeyN',
                        o: 'KeyO',
                        p: 'KeyP',
                        q: 'KeyQ',
                        r: 'KeyR',
                        s: 'KeyS',
                        t: 'KeyT',
                        u: 'KeyU',
                        v: 'KeyV',
                        w: 'KeyW',
                        x: 'KeyX',
                        y: 'KeyY',
                        z: 'KeyZ'
                    },
                    wouterCodeNumpad: {
                        left: 'ArrowLeft',
                        up: 'ArrowUp',
                        right: 'ArrowRight',
                        down: 'ArrowDown',

                        minus: 'Minus',
                        plus: 'Equal',
                        divide: 'BracketLeft',
                        times: 'BracketRight',
                        nthroot: 'Quote',
                        power: 'Backslash',
                        equals: 'Slash',

                        space: 'Space',
                        tab: 'Tab',
                        escape: 'Escape',
                        enter: 'Enter',
                        apestaart: 'Backquote',
                        backspace: 'Backspace',


                        f1: 'F1',
                        f2: 'F2',
                        f3: 'F3',
                        f4: 'F4',
                        f5: 'F5',
                        f6: 'F6',
                        f7: 'F7',
                        f8: 'F8',
                        f9: 'F9',
                        f10: 'F10',
                        f11: 'F11',
                        f12: 'F12',

                        0: 'Digit0',
                        1: 'Digit1',
                        2: 'Digit2',
                        3: 'Digit3',
                        4: 'Digit4',
                        5: 'Digit5',
                        6: 'Digit6',
                        7: 'Digit7',
                        8: 'Digit8',
                        9: 'Digit9',

                        0: 'Numpad0',
                        1: 'Numpad1',
                        2: 'Numpad2',
                        3: 'Numpad3',
                        4: 'Numpad4',
                        5: 'Numpad5',
                        6: 'Numpad6',
                        7: 'Numpad7',
                        8: 'Numpad8',
                        9: 'Numpad9',

                        a: 'KeyA',
                        b: 'KeyB',
                        c: 'KeyC',
                        d: 'KeyD',
                        e: 'KeyE',
                        f: 'KeyF',
                        g: 'KeyG',
                        h: 'KeyH',
                        i: 'KeyI',
                        j: 'KeyJ',
                        k: 'KeyK',
                        l: 'KeyL',
                        m: 'KeyM',
                        n: 'KeyN',
                        o: 'KeyO',
                        p: 'KeyP',
                        q: 'KeyQ',
                        r: 'KeyR',
                        s: 'KeyS',
                        t: 'KeyT',
                        u: 'KeyU',
                        v: 'KeyV',
                        w: 'KeyW',
                        x: 'KeyX',
                        y: 'KeyY',
                        z: 'KeyZ'
                    }
                };

                keyboardSelectElement = document.getElementById('keyboardType');
                keyboardType = keyboardSelectElement.value;

                function changeKeyboardType() {
                    keyboardSelectElement = document.getElementById('keyboardType');
                    keyboardType = keyboardSelectElement.value;
                    keyLookup = keyboardType in keyboardlookups? keyboardlookups[keyboardType] : invertSimple(keyboards[keyboardType]);
                };

                // maak opzoektabel voor ingedrukte toetsen, gebaseerd op het gekozen keyboardType (voor de oude versies was het met invert door stommiteiten)
                var keyLookup = keyboardType in keyboardlookups? keyboardlookups[keyboardType] : invertSimple(keyboards[keyboardType]);

                document.onpointerdown = pointerdown

                function pointerdown(e) {
                    
                }

                document.onkeydown = keysPressed

                function keysPressed(e) {

                    out.innerHTML = e.code;

                    if (e.shiftKey == 1)
                        switch (keyLookup[e.code]) {
                            // pijltjes met shift
                            case 'left': keysList.push('shift left'); e.preventDefault(); leftSlurp(equation); break;
                            case 'up': out.innerHTML = 'shift up'; break;
                            case 'right': keysList.push('shift right'); e.preventDefault(); rightSlurp(equation); break;
                            case 'down': keysList.push('shift down'); e.preventDefault(); updateLatex(flatten(equation)); break;

                            // Speciale tekens met shift
                            // case 'equals': equation = math.parse(expr.value); updateLatex(equation); break;
                            case 'minus': applyUnaryMinus(); keysList.push('applyUnaryMinus'); break;

                            // Cijfers met shift
                            case '1': e.preventDefault(); inputDigit(1, equation); break;
                            case '2': e.preventDefault(); inputDigit(2, equation); break;
                            case '3': e.preventDefault(); inputDigit(3, equation); break;
                            case '4': e.preventDefault(); inputDigit(4, equation); break;
                            case '5': e.preventDefault(); inputDigit(5, equation); break;
                            case '6': e.preventDefault(); inputDigit(6, equation); break;
                            case '7': e.preventDefault(); inputDigit(7, equation); break;
                            case '8': e.preventDefault(); inputDigit(8, equation); break;
                            case '9': e.preventDefault(); inputDigit(9, equation); break;
                            case '0': e.preventDefault(); inputDigit(0, equation); break;

                            // letters met shift
                            case 'a': SelectAllLettersInSelection('a', equation); break; // shift a
                            case 'b': SelectAllLettersInSelection('b', equation); break; // shift b
                            // case 'c': SelectAllLettersInSelection('c', equation); break; // shift c
                            case 'x': SelectAllLettersInSelection('x', equation); break; // shift x
                            case 'y': SelectAllLettersInSelection('y', equation); break; // shift y
                            case 'z': SelectAllLettersInSelection('z', equation); break; // shift z

                            case 's': applyFunction('sin', equation); break;
                            case 'c': applyFunction('cos', equation); break;
                            case 't': applyFunction('tan', equation); break; 
                            case 'f': applyFunction('f', equation); break;
                            case 'g': applyFunction('g', equation); break;
                            case 'h': applyFunction('h', equation); break;
                            case 'l': applyLog(equation); break;
                            case 'e': e.preventDefault(); replaceWithE(equation); break;
                            case 'p': replaceWithPi(equation); break; 
                            case 'i': applyIntegral(equation); break; 
                            case 'd': applyDerivative(equation); break;
                        }



                    else if (e.ctrlKey == 1)
                        switch (keyLookup[e.code]) {
                            case 'left': out.innerHTML = 'CTRLleft'; break;
                            case 'up': out.innerHTML = 'CTRLup'; updateLatex(herbalanceertermen(equation,'opwaarts')); keysList.push('herbalanceertermen'); updateLatex(equation);break;
                            case 'right': out.innerHTML = 'CTRLright'; break;
                            case 'down': out.innerHTML = 'CTRLdown'; updateLatex(herbalanceertermen(equation,'neerwaarts')); keysList.push('herbalanceertermen'); updateLatex(equation);break;

                            // letters

                            case 'd': e.preventDefault(); updateLatex(distributeOrFactorSelectedLeft(equation)); keysList.push('distributeOrFactorSelectedLeft'); updateLatex(equation); break;
                            //        case 's': e.preventDefault(); factorSelected(equation); keysList.push('factorSelected'); updateLatex(equation); break;
                            //        case 'a': e.preventDefault(); alert('CTRL - f');
                            // case 'x': e.preventDefault(); alert('CTRL - f');
                            //  case 'y': e.preventDefault(); alert('CTRL - f');
                            // case 'c': e.preventDefault(); alert('CTRL - f');
                            // case 'b': e.preventDefault(); alert('CTRL - f');

                        }

                    else if (e.metaKey == 1)

                        switch (keyLookup[e.code]) {
                            case 'left': out.innerHTML = 'left'; break;
                            case 'up': out.innerHTML = 'up'; break;
                            case 'right': out.innerHTML = 'right'; break;
                            case 'down': out.innerHTML = 'down'; break;

                            case 'x': e.preventDefault(); alert('meta - x');
                            case 'y': e.preventDefault(); alert('meta - y');
                            case 'c': e.preventDefault(); alert('meta - c');
                            case 'b': e.preventDefault(); alert('meta - b');

                        }

                    else if (e.altKey == 1)

                        switch (keyLookup[e.code]) {
                            case 'left': e.preventDefault(); commuteSelectedWithPrevious(equation); keysList.push('commuteWithPrevious'); break;
                            case 'up': e.preventDefault(); substitueerNaar(equation, "boven"); break;
                            case 'right': e.preventDefault(); commuteSelectedWithNext(equation); keysList.push('commuteWithNext'); break;
                            case 'down': e.preventDefault(); substitueerNaar(equation, "onder"); break;

                            // Specialkeys  
                            case 'plus': replaceWithPlus(); keysList.push('replacePlus'); break;
                            case 'times': replaceWithTimes(); keysList.push('replaceTimes'); break;
                            case 'power': replaceWithPower(); keysList.push('replacePower'); break;
                            case 'divide': replaceWithDivide(); keysList.push('replaceDivide'); break;
                            case 'minus': replaceWithMinus(); keysList.push('replaceMinus'); break;
                            case 'nthroot': replaceWithNthroot(); keysList.push('replaceNthroot'); break;
                            case 'equals': replaceWithEquality(); keysList.push('replaceEquals'); break;

                            // letters
                            case 'd': e.preventDefault(); drawGraph(equation); break;


                        }

                    else

                        // ********************************
                        //   zonder modifier keys
                        // ********************************

                        switch (keyLookup[e.code]) {
                            case 'left': keysList.push('left'); e.preventDefault(); leftSelect(equation); break;
                            case 'up': keysList.push('up'); e.preventDefault(); upSelect(equation); break;
                            case 'right': keysList.push('right'); e.preventDefault(); rightSelect(equation); break;
                            case 'down': keysList.push('down'); e.preventDefault(); downSelect(equation); break;

                            // Specialkeys        
                            case 'plus': applyPlus(); keysList.push('applyPlus'); break;
                            case 'times': applyTimes(); keysList.push('applyTimes'); break;
                            case 'power': applyPower(); keysList.push('applyPower'); break;
                            case 'minus': applyMinus(); keysList.push('applyMinus'); break;
                            case 'divide': applyDivide(); keysList.push('applyDivide'); break;
                            case 'nthroot': applyNthroot(); keysList.push('applyNthroot'); break;
                            case 'equals': updateLatex(applyEquality(equation)); keysList.push('applyEquals'); break;

                            // Extra keys
                            case 'space': e.preventDefault(); keysList.push('space'); spaceBar(equation); break;
                            case 'enter': enter(equation
                            ); keysList.push('enter'); break;
                            case 'backspace': backSpace(); keysList.push('backspace'); break;
                            case 'tab': e.preventDefault(); substitueerNaar(equation,'boven'); keysList.push('tab'); break;

                            // tekens
                            case 'KeyM': komma(); keysList.push('komma'); break;
                            case 'Comma': puntKomma(); keysList.push('puntKomma'); break;
                            case 'Period': dubbelPunt(); keysList.push('puntKomma'); break;
                            case 'IntlBackslash': kleinerDan(); keysList.push('kleinerDan'); break;

                            // Cijfers
                            case '1': e.preventDefault(); replaceWithDigit('1', equation); break;
                            case '2': e.preventDefault(); replaceWithDigit('2', equation); break;
                            case '3': e.preventDefault(); replaceWithDigit('3', equation); break;
                            case '4': e.preventDefault(); replaceWithDigit('4', equation); break;
                            case '5': e.preventDefault(); replaceWithDigit('5', equation); break;
                            case '6': e.preventDefault(); replaceWithDigit('6', equation); break;
                            case '7': e.preventDefault(); replaceWithDigit('7', equation); break;
                            case '8': e.preventDefault(); replaceWithDigit('8', equation); break;
                            case '9': e.preventDefault(); replaceWithDigit('9', equation); break;
                            case '0': e.preventDefault(); replaceWithDigit('0', equation); break;
                            // letters
                            case 'a': e.preventDefault(); replaceWithLetter('a',equation); break; //  a
                            case 'b': e.preventDefault(); replaceWithLetter('b',equation); break; //  b
                            case 'c': e.preventDefault(); replaceWithLetter('c',equation); break; //  c7
                            case 'x': e.preventDefault(); replaceWithLetter('x',equation); break; //  8
                            case 'y': e.preventDefault(); replaceWithLetter('y',equation); break; //  9
                            case 'z': e.preventDefault(); replaceWithLetter('z',equation); //  0

                            // Functieknoppen
                            case 'f1': e.preventDefault(); f1(equation); break;
                            case 'f2': e.preventDefault(); f2(equation); break;
                            case 'f3': e.preventDefault(); f3(equation); break;
                            case 'f4': e.preventDefault(); f4(equation); break;
                            case 'f5': e.preventDefault(); f5(equation); break;
                            case 'f6': e.preventDefault(); f6(equation); break;
                            case 'f7': e.preventDefault(); f7(equation); break;
                            case 'f8': e.preventDefault(); f8(equation); break;
                            case 'f9': e.preventDefault(); f9(equation); break;
                            case 'f10': e.preventDefault(); f10(equation); break;
                            case 'f11': e.preventDefault(); f11(equation); break;
                            case 'f12': e.preventDefault(); f12(equation); break;
                        }
                };



                // plaats een beginvergelijking in het begin (moet hier staan want anders loopt alles vast)
                // equation = math.parse('Select(Times(4,9))^2( + y^2 == Select(Times(2,512))');
                equation = math.parse('Select(pow(Times(a,Plus(9,a)),2))==a');

                prevEquation = equation;
                updateLatex(equation);

            </script>



        </div>

    </body>
